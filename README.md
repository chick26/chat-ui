# æ™ºèƒ½å¯¹è¯åŠ©æ‰‹ (Chat-UI)

åŸºäºReactå’ŒChatUIåº“æ„å»ºçš„æ™ºèƒ½å¯¹è¯åº”ç”¨ï¼Œæ”¯æŒå¤šåœºæ™¯é—®ç­”å’Œè‡ªå®šä¹‰å¯¹è¯ç•Œé¢ã€‚

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯åŸºäºé˜¿é‡Œå·´å·´å¼€æºçš„ [ChatUI](https://github.com/alibaba/ChatUI) ç»„ä»¶åº“å’Œ [Dify API](https://docs.dify.ai/api) è¿›è¡Œçš„äºŒæ¬¡å°è£…å¼€å‘ï¼Œæ—¨åœ¨æä¾›ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€ç•Œé¢ç¾è§‚çš„æ™ºèƒ½å¯¹è¯åº”ç”¨è§£å†³æ–¹æ¡ˆã€‚

### æŠ€æœ¯æ ˆ
- **å‰ç«¯æ¡†æ¶**: React + TypeScript
- **UIç»„ä»¶åº“**: ChatUI (é˜¿é‡Œå·´å·´å¼€æº)
- **APIæœåŠ¡**: Dify API (æ”¯æŒå¤šç§LLMæ¨¡å‹)
- **æ„å»ºå·¥å…·**: Create React App

### æ ¸å¿ƒç‰¹æ€§
- ğŸ¨ åŸºäºChatUIçš„ä¸“ä¸šçº§èŠå¤©ç•Œé¢
- ğŸ¤– é›†æˆDify APIï¼Œæ”¯æŒå¤šç§AIæ¨¡å‹
- ğŸ”§ äºŒæ¬¡å°è£…ä¼˜åŒ–ï¼Œå¼€ç®±å³ç”¨
- ğŸ“± å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯
- ğŸ”„ æµå¼å“åº”ï¼Œå®æ—¶æ˜¾ç¤ºAIæ€è€ƒè¿‡ç¨‹

## åŠŸèƒ½ä»‹ç»

æœ¬åº”ç”¨æ˜¯ä¸€ä¸ªå¤šåŠŸèƒ½çš„èŠå¤©ç•Œé¢ï¼Œä¸»è¦æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š

### æ ¸å¿ƒåŠŸèƒ½
- å¤šåœºæ™¯æ™ºèƒ½å¯¹è¯ï¼ˆè·¯ç”±æ–¹æ¡ˆç”Ÿæˆã€æµ·ç¼†æ•…éšœé—®ç­”ã€è¿ç»´è§„ç¨‹é—®ç­”ï¼‰
- åŸºäºChatUIçš„ç¾è§‚èŠå¤©ç•Œé¢
- æ¶ˆæ¯å†å²è®°å½•ç®¡ç†
- æ”¯æŒå¤šç§æ¶ˆæ¯ç±»å‹ï¼ˆæ–‡æœ¬ã€å›¾ç‰‡ã€è·¯ç”±ä¿¡æ¯ç­‰ï¼‰
- å¿«é€Ÿå›å¤/ç¤ºä¾‹é—®é¢˜åŠŸèƒ½
- å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯

### ç‰¹è‰²åŠŸèƒ½
- åœºæ™¯åˆ‡æ¢ï¼šå¯åœ¨ä¸åŒèŠå¤©æœºå™¨äººä¹‹é—´åˆ‡æ¢
- å¤šåœºæ™¯ Token æ”¯æŒï¼šä¸åŒåœºæ™¯å¯ä½¿ç”¨ä¸åŒçš„ API Token
- æ¸…ç©ºå†å²ï¼šæ”¯æŒä¸€é”®æ¸…ç©ºèŠå¤©è®°å½•
- è‡ªå®šä¹‰æ¶ˆæ¯ç»„ä»¶ï¼šæ”¯æŒè·¯ç”±åœ°å›¾ã€æ•…éšœæŠ¥å‘Šç­‰ç‰¹å®šæ¶ˆæ¯ç±»å‹
- å®‰å…¨åŒºé€‚é…ï¼šæ”¯æŒiPhoneç­‰è®¾å¤‡çš„åˆ˜æµ·å±å’Œåº•éƒ¨æŒ‡ç¤ºæ¡

## é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ components/         # UIç»„ä»¶
â”‚   â”œâ”€â”€ ChatWindow/     # èŠå¤©çª—å£ç»„ä»¶
â”‚   â”œâ”€â”€ Sidebar/        # ä¾§è¾¹æ ç»„ä»¶
â”‚   â”œâ”€â”€ Markdown/       # Markdownæ¸²æŸ“ç»„ä»¶ï¼ˆæ”¯æŒæ€è€ƒè¿‡ç¨‹ï¼‰
â”‚   â”œâ”€â”€ CableResponse/  # æµ·ç¼†æ•…éšœå›å¤ç»„ä»¶
â”‚   â”œâ”€â”€ RouteResponse/  # è·¯ç”±æ–¹æ¡ˆå›å¤ç»„ä»¶
â”‚   â””â”€â”€ MaintenanceResponse/ # è¿ç»´è§„ç¨‹å›å¤ç»„ä»¶
â”œâ”€â”€ config/             # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ api.ts          # APIé…ç½®ï¼ˆç¯å¢ƒå˜é‡ç®¡ç†ï¼‰
â”œâ”€â”€ data/               # æ•°æ®ç›¸å…³
â”‚   â””â”€â”€ bots.ts         # æœºå™¨äººé…ç½®å’Œç¤ºä¾‹é—®é¢˜
â”œâ”€â”€ services/           # æœåŠ¡å±‚
â”‚   â””â”€â”€ chatService.ts  # èŠå¤©APIæœåŠ¡
â”œâ”€â”€ mock/               # æ¨¡æ‹Ÿæ•°æ®
â”‚   â””â”€â”€ chatResponses.ts # æ¨¡æ‹ŸAPIå“åº”
â”œâ”€â”€ pages/              # é¡µé¢ç»„ä»¶
â”‚   â””â”€â”€ Main/           # ä¸»é¡µé¢
â”œâ”€â”€ router/             # è·¯ç”±é…ç½®
â”‚   â””â”€â”€ index.tsx       # è·¯ç”±å®šä¹‰
â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°
â”œâ”€â”€ App.tsx             # åº”ç”¨å…¥å£
â””â”€â”€ index.tsx           # Reactå…¥å£

# é…ç½®æ–‡ä»¶
â”œâ”€â”€ .env                # ç¯å¢ƒå˜é‡ï¼ˆgitå¿½ç•¥ï¼‰
â”œâ”€â”€ env.template        # ç¯å¢ƒå˜é‡æ¨¡æ¿
â””â”€â”€ docs/               # æ–‡æ¡£
    â””â”€â”€ ENVIRONMENT_SETUP.md # ç¯å¢ƒé…ç½®æŒ‡å—
```

## å¼€å§‹ä½¿ç”¨

### ç¯å¢ƒé…ç½®

é¦–å…ˆè®¾ç½®Dify APIé…ç½®ï¼š

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp env.template .env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥å®é™…çš„Dify APIé…ç½®
# REACT_APP_API_BASE_URL=https://your-dify-api-server
# REACT_APP_API_TOKEN=your-dify-api-token
```

> **æ³¨æ„**: éœ€è¦å…ˆéƒ¨ç½²Difyå¹³å°æˆ–ä½¿ç”¨Difyäº‘æœåŠ¡ï¼Œè·å–ç›¸åº”çš„APIåœ°å€å’ŒTokenã€‚è¯¦æƒ…è¯·å‚è€ƒ [Difyå®˜æ–¹æ–‡æ¡£](https://docs.dify.ai/)

è¯¦ç»†é…ç½®è¯´æ˜è¯·å‚è€ƒï¼š[ç¯å¢ƒé…ç½®æŒ‡å—](./docs/ENVIRONMENT_SETUP.md)

### å®‰è£…ä¾èµ–

```bash
npm install
```

### è¿è¡Œå¼€å‘ç¯å¢ƒ

```bash
npm start
```

åº”ç”¨å°†åœ¨ [http://localhost:3000](http://localhost:3000) å¯åŠ¨ã€‚

### æ„å»ºç”Ÿäº§ç¯å¢ƒ

```bash
npm run build
```

## ä¿®æ”¹æŒ‡å—

### æ·»åŠ /ä¿®æ”¹åœºæ™¯

ç¼–è¾‘ `src/data/bots.ts` æ–‡ä»¶ä¸­çš„ `bots` æ•°ç»„ï¼š

```typescript
export const bots: Bot[] = [
  {
    id: 'new-scene',            // åœºæ™¯IDï¼Œå”¯ä¸€æ ‡è¯†
    name: 'æ–°åœºæ™¯åç§°',          // æ˜¾ç¤ºçš„åœºæ™¯åç§°
    description: 'åœºæ™¯æè¿°',     // åœºæ™¯ç®€çŸ­æè¿°
    icon: 'icon-name',          // å›¾æ ‡åç§°ï¼Œä½¿ç”¨ChatUIå›¾æ ‡åº“
  },
  // å…¶ä»–åœºæ™¯...
];
```

åŒæ—¶æ·»åŠ è¯¥åœºæ™¯çš„ç¤ºä¾‹é—®é¢˜ï¼š

```typescript
export const examples: Record<string, ChatExample[]> = {
  // ç°æœ‰ç¤ºä¾‹...
  'new-scene': [
    { text: 'ç¤ºä¾‹é—®é¢˜1' },
    { text: 'ç¤ºä¾‹é—®é¢˜2' },
    // æ›´å¤šç¤ºä¾‹é—®é¢˜...
  ],
};
```

### æ·»åŠ æ–°çš„æ¶ˆæ¯ç±»å‹

1. åˆ›å»ºæ–°çš„å“åº”ç»„ä»¶ï¼Œä¾‹å¦‚ `src/components/NewResponse/index.tsx`
2. åœ¨ `src/components/ChatWindow/index.tsx` çš„ `renderMessageContent` å‡½æ•°ä¸­æ·»åŠ å¤„ç†ï¼š

```typescript
if (type === 'new-type') {
  return (
    <Bubble type="text">
      <NewResponse 
        // ä¼ é€’æ‰€éœ€å±æ€§
        property1={content.property1}
        property2={content.property2}
      />
    </Bubble>
  );
}
```

### ä¿®æ”¹æ ·å¼

ä¸»è¦æ ·å¼æ–‡ä»¶:
- `src/components/ChatWindow/style.css` - èŠå¤©çª—å£æ ·å¼
- `src/pages/Main/style.css` - ä¸»é¡µé¢å¸ƒå±€æ ·å¼

ChatUIæ”¯æŒä¸»é¢˜å®šåˆ¶ï¼Œå¯ä»¥é€šè¿‡CSSå˜é‡è¦†ç›–é»˜è®¤æ ·å¼ï¼š

```css
:root {
  --brand-1: #255bda; /* ä¸»é¢˜è‰² */
  --brand-2: #255bda; /* ä¸»é¢˜è‰²-é‡ç‚¹ */
  --brand-3: #316cf1; /* ä¸»é¢˜è‰²-è½»é‡ */
}
```

### å›¾æ ‡ä½¿ç”¨

ChatUI å›¾æ ‡é€šè¿‡ä»¥ä¸‹æ–¹å¼å¼•å…¥ï¼š

```html
<script src="//g.alicdn.com/chatui/icons/2.0.2/index.js"></script>
```

åœ¨ç»„ä»¶ä¸­ä½¿ç”¨å›¾æ ‡:

```jsx
// å¯¼èˆªæ å›¾æ ‡
<Chat
  navbar={{ 
    title: "æ ‡é¢˜",
    rightContent: [{ icon: 'icon-name', onClick: handleClick }]
  }}
/>
```

## Dify APIæ¥å…¥

åº”ç”¨å·²é›†æˆDify APIï¼Œæ”¯æŒå¤šç§å¤§è¯­è¨€æ¨¡å‹ï¼Œé€šè¿‡ç¯å¢ƒå˜é‡è¿›è¡Œé…ç½®ï¼š

### APIé…ç½®
- **é…ç½®æ–‡ä»¶**: `src/config/api.ts`
- **æœåŠ¡å±‚**: `src/services/chatService.ts`
- **ç¯å¢ƒå˜é‡**: `.env` æ–‡ä»¶

### Dify APIç‰¹æ€§
- âœ… æµå¼å“åº”å¤„ç† (Server-Sent Events)
- âœ… å®æ—¶æ€è€ƒè¿‡ç¨‹æ˜¾ç¤º
- âœ… é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- âœ… å¤šç§äº‹ä»¶ç±»å‹æ”¯æŒï¼ˆworkflowã€nodeã€messageç­‰ï¼‰
- âœ… æ”¯æŒå¤šç§å¤§è¯­è¨€æ¨¡å‹ï¼ˆGPTã€Claudeã€æ–‡å¿ƒä¸€è¨€ç­‰ï¼‰
- âœ… å·¥ä½œæµæ¨¡å¼æ”¯æŒ

### Dify APIäº‹ä»¶æ ¼å¼
åº”ç”¨æ”¯æŒå¤„ç†ä»¥ä¸‹Dify APIæ ‡å‡†äº‹ä»¶ç±»å‹ï¼š
- `workflow_started` - å·¥ä½œæµå¼€å§‹
- `node_started` - èŠ‚ç‚¹å¼€å§‹
- `node_finished` - èŠ‚ç‚¹å®Œæˆ
- `message` - æ¶ˆæ¯å†…å®¹
- `message_end` - æ¶ˆæ¯ç»“æŸ
- `workflow_finished` - å·¥ä½œæµå®Œæˆ

### è‡ªå®šä¹‰API
å¦‚éœ€ä¿®æ”¹APIé€»è¾‘ï¼Œè¯·ç¼–è¾‘ï¼š
1. `src/config/api.ts` - ä¿®æ”¹APIé…ç½®
2. `src/services/chatService.ts` - ä¿®æ”¹è¯·æ±‚å¤„ç†é€»è¾‘

## è®¸å¯è¯

ISC
